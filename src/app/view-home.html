<div id="now-playing-view">
	<div id="scover"></div>
	<div id="stitle"></div>
	<div id="sartist"></div>
	<div id="slen">
		<div id="selapsed"></div>
		<input type="range" id="stime-slider">
		<div id="stotal"></div>
	</div>
</div>

<style>
	#now-playing-view {
		display: flex;
		flex-direction: column;
		align-items: center;
	}
	#scover {
		width: 200px;
		height: 200px;
		background-size: cover;
		background-position: center;
		margin: 20px;
	}
	#stitle {
		font-size: 1.5em;
	}
	#sartist {
		font-size: 1.2em;
	}
	#slen {
		display: flex;
		flex-direction: row;
		align-items: center;
	}
</style>

<script type="module">
	import { _ytm } from './app.js';
	let _nowPlaying = null;
	_ytm.send('get_now_playing');
	setInterval(() => {
		_ytm.send('get_now_playing');
	},1000);
	_ytm.onData('get_now_playing', (songData) => {
		_nowPlaying = songData[0];
		update();
	})

	const update = () => {
		if (_nowPlaying) {
			document.getElementById('scover').style.backgroundImage = `url(${_nowPlaying.snippet.thumbnails.medium.url})`;
			document.getElementById('stitle').innerText = _nowPlaying.snippet.title;
			document.getElementById('sartist').innerText = _nowPlaying.snippet.videoOwnerChannelTitle;
			document.getElementById('stime-slider').max = _ytm.globalAudio.duration;
			document.getElementById('stime-slider').value = _ytm.globalAudio.currentTime;
			document.getElementById('stime-slider').oninput = (e) => {
				_ytm.globalAudio.currentTime = e.target.value;
			}
			document.getElementById('selapsed').innerText = formatTimestamp(_ytm.globalAudio.currentTime);
			document.getElementById('stotal').innerText = formatTimestamp(_ytm.globalAudio.duration);
		}
	}
	const formatTimestamp = (timestamp) => {
		let minutes = Math.floor(timestamp / 60);
		let seconds = Math.floor(timestamp % 60);
		return `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
	}
</script>